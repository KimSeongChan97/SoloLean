<%@ page language="java" contentType="text/html; charset=UTF-8"
    pageEncoding="UTF-8"%>
<%@page import="member.bean.MemberDTO" %>
<%@page import="member.dao.MemberDAO" %>    
   

<%
	// 한글 인코딩
	request.setCharacterEncoding("UTF-8");
	
    // POST 요청으로 넘어온 데이터 처리
    String name = request.getParameter("name"); // 사용자가 입력한 이름을 가져옵니다.
    String id = request.getParameter("id"); // 사용자가 입력한 ID를 가져옵니다.
    String pwd = request.getParameter("pwd"); // 사용자가 입력한 비밀번호를 가져옵니다. 
    String gender = request.getParameter("gender"); // 성별 선택 값을 가져옵니다.
    String email1 = request.getParameter("email1"); // 이메일 앞 부분 (예: user) 값을 가져옵니다.
    String email2 = request.getParameter("email2"); // 이메일 도메인 부분 (예: naver.com)을 가져옵니다.
    String tel1 = request.getParameter("tel1"); // 전화번호 첫 부분 (예: 010)을 가져옵니다.
    String tel2 = request.getParameter("tel2"); // 전화번호 중간 부분 (예: 1234)을 가져옵니다.
    String tel3 = request.getParameter("tel3"); // 전화번호 마지막 부분 (예: 5678)을 가져옵니다.
    String zipcode = request.getParameter("zipcode"); // 사용자가 입력한 우편번호를 가져옵니다.
    String addr1 = request.getParameter("addr1"); // 사용자가 입력한 기본 주소를 가져옵니다.
    String addr2 = request.getParameter("addr2"); // 사용자가 입력한 상세 주소를 가져옵니다.

    // MemberDTO 객체에 폼 데이터 담기
    MemberDTO memberDTO = new MemberDTO();
    memberDTO.setName(name);
    memberDTO.setId(id);
    memberDTO.setPwd(pwd);
    memberDTO.setGender(gender);
    memberDTO.setEmail1(email1);
    memberDTO.setEmail2(email2);
    memberDTO.setTel1(tel1);
    memberDTO.setTel2(tel2);
    memberDTO.setTel3(tel3);
    memberDTO.setZipcode(zipcode);
    memberDTO.setAddr1(addr1);
    memberDTO.setAddr2(addr2);

    // 데이터베이스 업데이트
    MemberDAO memberDAO = MemberDAO.getInstance();
    memberDAO.updateMember(memberDTO);

    if (updatedMember != null) {  // 업데이트 성공 시
        // 로그아웃 처리: 세션을 만료시키고, index.jsp로 이동
        session.invalidate(); // 세션 만료

        // JavaScript로 성공 메시지 및 리다이렉트 처리
%>
        <script>
            alert("회원정보 수정이 완료되었습니다. 다시 로그인 해주세요.");
            location.href = "/projectJSP/index.jsp"; // index.jsp로 이동
        </script>
<%
    } else {  // 업데이트 실패 시
%>
        <script>
            alert("회원정보 수정에 실패하였습니다. 다시 시도해주세요.");
            history.back(); // 이전 페이지로 돌아가기
        </script>
<%
    }
%>
