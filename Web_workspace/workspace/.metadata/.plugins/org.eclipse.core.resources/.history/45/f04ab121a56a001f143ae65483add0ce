<%@ page language="java" contentType="text/html; charset=UTF-8" pageEncoding="UTF-8"%>
<%@ page import="member.dao.MemberDAO" %>
<html>
<head>
    <title>회원가입 완료</title>
</head>
<body>
<%
    // 유효성 검사를 위한 변수
    String id = request.getParameter("id");
    String pwd = request.getParameter("pwd");
    String repwd = request.getParameter("repwd");
    String name = request.getParameter("name");
    String email1 = request.getParameter("email1");
    String email2 = request.getParameter("email2");

    // '@'가 email1에 포함되어 있는 경우 제거
    if (email1.contains("@")) {
        email1 = email1.split("@")[0]; // '@' 이전의 문자열만 사용
    }

    // 입력값 체크
    if (id == null || id.trim().isEmpty()) {
        out.println("<script>alert('아이디를 입력해주세요'); history.back();</script>");
    } else if (pwd == null || pwd.trim().isEmpty()) {
        out.println("<script>alert('비밀번호를 입력해주세요'); history.back();</script>");
    } else if (!pwd.equals(repwd)) {
        out.println("<script>alert('비밀번호가 일치하지 않습니다'); history.back();</script>");
    } else if (name == null || name.trim().isEmpty()) {
        out.println("<script>alert('이름을 입력해주세요'); history.back();</script>");
    } else {
        // DB 저장 처리
        MemberDAO memberDAO = MemberDAO.getInstance();
        memberDAO.insertMember(id, pwd, name, email1, email2);
        out.println("<script>alert('회원가입이 완료되었습니다'); location.href='index.jsp';</script>");
    }
%>
</body>
</html>
