<%@ page language="java" contentType="text/html; charset=UTF-8" pageEncoding="UTF-8"%>
<%@ page import="board.dao.BoardDAO" %>
<%@ page import="board.bean.BoardDTO" %>
<%@ page import="board.bean.BoardPaging" %>
<%@ page import="java.util.List" %>

<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>게시글 목록</title>
    <link rel="stylesheet" type="text/css" href="/projectJSP/css/boardList.css">
</head>
<body>

    <!-- 네비게이션 바 삽입 -->
    <jsp:include page="/jsp/nav.jsp" />

    <h2 align="center" style="font-family: 'Comic Sans MS';" onclick="location.href='../index.jsp'">N o t e </h2>

    <%
        // 현재 페이지 번호를 URL에서 가져옵니다. 없으면 기본값은 1페이지
         int pg = Integer.parseInt(request.getParameter("pg"));
        // int currentPage = (request.getParameter("page") != null) ? Integer.parseInt(request.getParameter("page")) : 1; 

     // 한 페이지당 표시할 게시글 수를 5개로 설정합니다.
        // 따라서 'pg'에 따라 계산된 startNum과 endNum으로 해당 페이지에 표시될 게시글을 가져옵니다.
        int endNum = pg * 5; // 현재 페이지에서 끝 번호를 계산합니다. 5개씩 보여주므로 예를 들어, 1페이지는 1~5번 글을 가져옵니다.
        // startNum은 endNum에서 4를 뺀 값으로, 예를 들어 1페이지의 경우 1부터 시작하게 됩니다.
        int startNum = endNum - 4; // 시작 번호는 끝 번호에서 4를 뺀 값이 됩니다. 즉, 1페이지는 1번부터 시작하게 됩니다.

        // 총 게시글 수를 가져옵니다.
        int totalPosts = BoardDAO.getInstance().getTotalPosts();

        // DAO를 통해 현재 페이지에 해당하는 게시글 목록을 가져옵니다.
        BoardDAO boardDAO = BoardDAO.getInstance();
        List<BoardDTO> boardList = boardDAO.getBoardListByPage((currentPage - 1) * pageSize + 1, currentPage * pageSize);

        // 페이징을 위한 객체 생성
        BoardPaging boardPaging = new BoardPaging();
        boardPaging.setCurrentPage(pg);  // 현재 페이지 설정
        boardPaging.setPageBlock(3);  // 한 번에 보여줄 페이지 블록 수 (이전, 1, 2, 3, 다음)
        boardPaging.setPageSize(6);  // 한 페이지에 표시할 게시글 수
        boardPaging.setTotalA(totalA);  // 총 게시글 수 설정
        boardPaging.makePagingHTML();  // 페이징 HTML 생성
    %>

    <!-- 게시글 목록 테이블 -->
    <table border="1" style="width: 100%;">
        <tr>
            <th>번호</th>
            <th>제목</th>
            <th>작성자</th>
            <th>작성일</th>
            <th>조회수</th>
        </tr>

        <%
            // 가져온 게시글 목록을 순회하며 테이블에 출력
            for (BoardDTO board : boardList) {
        %>
        <tr>
            <td><%= board.getSeq() %></td>
            <td><a href="boardView.jsp?seq=<%= board.getSeq() %>"><%= board.getSubject() %></a></td>
            <td><%= board.getName() %></td>
            <td><%= board.getLogtime() %></td>
            <td><%= board.getHit() %></td>
        </tr>
        <%
            }
        %>
    </table>

    <!-- 페이징 HTML을 출력 -->
    <div class="paging">
        <script type="text/javascript">
    // 페이지 번호를 클릭하면 해당 페이지로 이동하는 함수입니다.
    function boardPaging(pg){
        // 사용자가 클릭한 페이지 번호를 'pg' 파라미터로 전달하여 해당 페이지로 이동합니다.
        location.href = "boardList.jsp?pg=" + pg;
    };
	</script>
    </div>

    <script type="text/javascript" src="http://code.jquery.com/jquery-3.7.1.min.js"></script>
</body>
</html>
