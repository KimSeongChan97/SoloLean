<%@ page language="java" contentType="text/html; charset=UTF-8"
    pageEncoding="UTF-8"%>
<%@ page import="java.sql.*" %>

<%
    Connection conn = null;
    PreparedStatement pstmt = null;
    ResultSet rs = null;

    try {
        Class.forName("oracle.jdbc.driver.OracleDriver");
        String dbURL = "jdbc:oracle:thin:@localhost:1521:XE";
        String dbUser = "hr";
        String dbPass = "hr";
        conn = DriverManager.getConnection(dbURL, dbUser, dbPass);

        String sql = "SELECT * FROM posts ORDER BY post_id DESC";
        pstmt = conn.prepareStatement(sql);
        rs = pstmt.executeQuery();

        int count = 1;
        while (rs.next()) {
            String title = rs.getString("title");
            String author = rs.getString("author");
            String date = rs.getString("created_at");
            int views = rs.getInt("views");
%>
            <tr>
                <th scope="row"><%= count++ %></th>
                <td><%= title %></td>
                <td><%= author %></td>
                <td><%= date %></td>
                <td><%= views %></td>
                <td><a href="post_view.jsp?id=<%= rs.getInt("post_id") %>" class="btn btn-primary">보기</a></td>
            </tr>
<%
        }
    } catch (Exception e) {
        e.printStackTrace();
    } finally {
        if (rs != null) try { rs.close(); } catch (SQLException e) { e.printStackTrace(); }
        if (pstmt != null) try { pstmt.close(); } catch (SQLException e) { e.printStackTrace(); }
        if (conn != null) try { conn.close(); } catch (SQLException e) { e.printStackTrace(); }
    }
%>
