<%@ page language="java" contentType="text/html; charset=UTF-8" pageEncoding="UTF-8"%>
<%@ taglib prefix="c" uri="http://java.sun.com/jsp/jstl/core" %>
<%@ page import="board.dao.BoardDAO" %>
<%@ page import="board.bean.BoardDTO" %>
<%@ page import="java.util.List" %>

<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>게시글 목록</title>
    <!-- 게시글 목록에 대한 스타일을 정의한 외부 CSS 파일을 연결합니다. 
         "/projectJSP/css/boardList.css" 경로에 있는 CSS 파일을 로드하여, 페이지 스타일을 적용합니다. -->
    <link rel="stylesheet" type="text/css" href="/projectJSP/css/boardList.css">
</head>
<body>

    <!-- 네비게이션 바를 포함합니다. 'nav.jsp' 파일을 삽입하여 상단 네비게이션 바가 나타나도록 합니다. 
         이를 통해 다른 페이지로 쉽게 이동할 수 있습니다. -->
    <jsp:include page="/jsp/nav.jsp" />

    <!-- 제목을 가운데 정렬하고, 클릭 시 메인 페이지('index.jsp')로 이동하는 h2 태그입니다. 
         Comic Sans MS 폰트를 사용하여 제목을 꾸몄습니다. -->
    <h2 align="center" style="font-family: 'Comic Sans MS';" onclick="location.href='../index.jsp'">N o t e </h2>

    <!-- JSTL을 사용하여 페이징 및 게시글 데이터를 처리합니다. -->
    <c:set var="currentPage" value="${param.page != null ? param.page : 1}" />
    <c:set var="postsPerPage" value="5" />
    <c:set var="totalPosts" value="${boardDAO.getTotalPosts()}" />
    <c:set var="totalPages" value="${fn:ceil(totalPosts / postsPerPage)}" />
    <c:set var="startPage" value="${fn:max(1, currentPage - 2)}" />
    <c:set var="endPage" value="${fn:min(totalPages, currentPage + 2)}" />
    <c:set var="boardList" value="${boardDAO.getBoardListByPage(currentPage, postsPerPage)}" />

    <table border="1" style="width: 100%;">
        <tr>
            <th>번호</th>
            <th>제목</th>
            <th>작성자</th>
            <th>작성일</th>
            <th>조회수</th>
        </tr>

        <!-- 게시글 목록 출력 -->
        <c:forEach var="board" items="${boardList}">
            <tr>
                <td>${board.seq}</td>
                <td><a href="boardView.jsp?seq=${board.seq}">${board.subject}</a></td>
                <td>${board.name}</td>
                <td>${board.logtime}</td>
                <td>${board.hit}</td>
            </tr>
        </c:forEach>
    </table>

    <!-- 페이징 처리 -->
    <nav aria-label="Page navigation" class="pagination-nav" style="margin-top: 20px;">
      <ul class="pagination justify-content-center">
        <!-- 이전 페이지로 이동 -->
        <li class="page-item ${currentPage == 1 ? 'disabled' : ''}">
          <a class="page-link" href="?page=${currentPage > 1 ? currentPage - 1 : 1}" aria-label="Previous">
            <span aria-hidden="true">&laquo;</span>
          </a>
        </li>

        <!-- 페이지 번호 출력 -->
        <c:forEach begin="${startPage}" end="${endPage}" var="i">
            <li class="page-item ${i == currentPage ? 'active' : ''}">
              <a class="page-link" href="?page=${i}">${i}</a>
            </li>
        </c:forEach>

        <!-- 다음 페이지로 이동 -->
        <li class="page-item ${currentPage == totalPages ? 'disabled' : ''}">
          <a class="page-link" href="?page=${currentPage < totalPages ? currentPage + 1 : totalPages}" aria-label="Next">
            <span aria-hidden="true">&raquo;</span>
          </a>
        </li>
      </ul>
    </nav>

    <script type="text/javascript" src="http://code.jquery.com/jquery-3.7.1.min.js"></script>
</body>
</html>
