<%@ page language="java" contentType="text/html; charset=UTF-8"
    pageEncoding="UTF-8"%>
<%@ page import="member.bean.MemberDTO" %>
<%@ page import="member.dao.MemberDAO" %>
<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>로그인 결과</title>
<script>
// 유효성 검사 함수
function validateLoginForm() {
    var id = document.loginForm.id.value.trim();
    var pwd = document.loginForm.pwd.value.trim();

    if (id === "") {
        document.getElementById("loginErrorDiv").innerHTML = "아이디를 입력하세요.";
        return false;
    }
    if (pwd === "") {
        document.getElementById("loginErrorDiv").innerHTML = "비밀번호를 입력하세요.";
        return false;
    }
    return true;
}

// 폼이 제출될 때 유효성 검사를 진행
document.loginForm.onsubmit = function() {
    return validateLoginForm();
};
</script>
</head>
<body>

<%
    // 유효성 검사를 통과했을 때만 로그인 처리
    String id = request.getParameter("id");
    String pwd = request.getParameter("pwd");

    if (id != null && pwd != null && !id.trim().isEmpty() && !pwd.trim().isEmpty()) {
        MemberDAO memberDAO = MemberDAO.getInstance();
        MemberDTO memberDTO = memberDAO.login(id, pwd);

        if (memberDTO != null) {
            // 로그인 성공 시
            session.setAttribute("loginUser", memberDTO);
%>
            <h2 align="center"><%= memberDTO.getName() %>님, 환영합니다!</h2>
            <a href="/projectJSP/index.jsp">메인 페이지로 돌아가기</a>
<%
        } else {
            // 로그인 실패 시
%>
            <h2 align="center" style="color:red;">아이디 또는 비밀번호가 틀렸습니다.</h2>
            <a href="/projectJSP/member/memberLoginForm.jsp">다시 로그인</a>
<%
        }
    } else {
%>
        <h2 align="center" style="color:red;">아이디 또는 비밀번호를 입력하세요.</h2>
        <a href="/projectJSP/member/memberLoginForm.jsp">다시 로그인</a>
<%
    }
%>

</body>
</html>
