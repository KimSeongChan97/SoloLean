<%@ page language="java" contentType="text/html; charset=UTF-8" pageEncoding="UTF-8"%>
<%@ page import="board.dao.BoardDAO" %>
<%@ page import="board.bean.BoardDTO" %>
<%@ page import="board.bean.BoardPaging" %>
<%@ page import="java.util.List" %>

<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>게시글 목록</title>
    <link rel="stylesheet" type="text/css" href="/projectJSP/css/boardList.css">
</head>
<body>

    <!-- 네비게이션 바 삽입 -->
    <jsp:include page="/jsp/nav.jsp" />

    <h2 align="center" style="font-family: 'Comic Sans MS';" onclick="location.href='../index.jsp'">N o t e </h2>

    <%
        // 현재 페이지 번호를 URL에서 가져옵니다. 없으면 기본값은 1페이지
        int currentPage = (request.getParameter("page") != null) ? Integer.parseInt(request.getParameter("page")) : 1; 

        // 페이지당 게시글 수
        int pageSize = 5;

        // 총 게시글 수를 가져옵니다.
        int totalPosts = BoardDAO.getInstance().getTotalPosts();

        // DAO를 통해 현재 페이지에 해당하는 게시글 목록을 가져옵니다.
        BoardDAO boardDAO = BoardDAO.getInstance();
        List<BoardDTO> boardList = boardDAO.getBoardListByPage((currentPage - 1) * pageSize + 1, currentPage * pageSize);

        // 페이징을 위한 객체 생성
        BoardPaging boardPaging = new BoardPaging();
        boardPaging.setCurrentPage(currentPage);  // 현재 페이지 설정
        boardPaging.setPageBlock(3);  // 한 번에 보여줄 페이지 블록 수 (이전, 1, 2, 3, 다음)
        boardPaging.setPageSize(6);  // 한 페이지에 표시할 게시글 수
        boardPaging.setTotalA(5);  // 총 게시글 수 설정
        boardPaging.makePagingHTML();  // 페이징 HTML 생성
    %>

    <!-- 게시글 목록 테이블 -->
    <table border="1" style="width: 100%;">
        <tr>
            <th>번호</th>
            <th>제목</th>
            <th>작성자</th>
            <th>작성일</th>
            <th>조회수</th>
        </tr>

        <%
            // 가져온 게시글 목록을 순회하며 테이블에 출력
            for (BoardDTO board : boardList) {
        %>
        <tr>
            <td><%= board.getSeq() %></td>
            <td><a href="boardView.jsp?seq=<%= board.getSeq() %>"><%= board.getSubject() %></a></td>
            <td><%= board.getName() %></td>
            <td><%= board.getLogtime() %></td>
            <td><%= board.getHit() %></td>
        </tr>
        <%
            }
        %>
    </table>

    <!-- 페이징 HTML을 출력 -->
    <div class="paging">
        <%= boardPaging.getPagingHTML().toString() %>
    </div>

    <script type="text/javascript" src="http://code.jquery.com/jquery-3.7.1.min.js"></script>
</body>
</html>
