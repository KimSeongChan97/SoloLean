<%@ page contentType="text/html;charset=UTF-8" language="java" %>
<%@ page import="java.sql.*, java.io.*" %>
<%
    // 데이터베이스 연결
    String dbURL = "jdbc:oracle:thin:@localhost:1521:xe";
    String dbUser = "hr"; // 사용자명
    String dbPass = "hr"; // 비밀번호

    Connection conn = null;
    Statement stmt = null;
    ResultSet rs = null;

    try {
        // 데이터베이스 연결
        Class.forName("oracle.jdbc.driver.OracleDriver");
        conn = DriverManager.getConnection(dbURL, dbUser, dbPass);

        // posts 테이블에서 게시글 목록 조회
        String sql = "SELECT post_id, title, author, created_at, views FROM posts ORDER BY created_at DESC";
        stmt = conn.createStatement();
        rs = stmt.executeQuery(sql);

        // 조회한 게시글 목록을 테이블에 출력
        while (rs.next()) {
            int postId = rs.getInt("post_id");
            String title = rs.getString("title");
            String author = rs.getString("author");
            Date createdAt = rs.getDate("created_at");
            int views = rs.getInt("views");

            out.println("<tr>");
            out.println("<td>" + postId + "</td>");
            out.println("<td>" + title + "</td>");
            out.println("<td>" + author + "</td>");
            out.println("<td>" + createdAt + "</td>");
            out.println("<td>" + views + "</td>");
            out.println("<td><a href='view_post.jsp?id=" + postId + "'>보기</a></td>");
            out.println("</tr>");
        }
    } catch (Exception e) {
        e.printStackTrace();
    } finally {
        try { if (rs != null) rs.close(); } catch (Exception e) {}
        try { if (stmt != null) stmt.close(); } catch (Exception e) {}
        try { if (conn != null) conn.close(); } catch (Exception e) {}
    }
%>