<%@ page language="java" contentType="text/html; charset=UTF-8"
    pageEncoding="UTF-8"%>
<%@ page import="board.dao.BoardDAO" %>
<%@ page import="board.bean.BoardDTO" %>
<%@ page session="true" %>


<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>게시글 보기</title>
    <link rel="stylesheet" type="text/css" href="/projectJSP/css/boardView.css">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body>

    <jsp:include page="/jsp/nav.jsp" />

    <h2 align="center" style="font-family: 'Comic Sans MS';"  
        onclick="location.href='../index.jsp'" > N o t e _ V i e w </h2>

     <%
        // 게시글 정보를 가져오는 로직
        int seq = Integer.parseInt(request.getParameter("seq"));
        BoardDAO boardDAO = BoardDAO.getInstance();

        // 조회수 증가
        boardDAO.increaseHit(seq);

        // 게시글 조회
        BoardDTO board = boardDAO.getBoard(seq);
    %>

    <div class="container">
        <!-- 왼쪽 섹션 -->
        <div class="left-section">
            <label for="subject">제목:</label>
            <div id="subject"><%= board.getSubject() %></div><br>

            <label for="content">내용:</label>
            <div id="content"><%= board.getContent() %></div><br>

            <label for="comment">댓글:</label>
            <div id="comment" class="comment-section">
                <!-- 댓글 목록이 여기에 표시됨 -->
                <ul class="comment-list">
                    <li>작성자1: 댓글 내용1</li>
                    <li>작성자2: 댓글 내용2</li>
                    <!-- 더 많은 댓글들이 여기에 추가됨 -->
                </ul>
            </div>
			
			
			<!-- 세션에 저장된 회원 이름 확인 -->
			<%
			    String sessionName = (String) session.getAttribute("memName");
			    if (sessionName != null) {
			    	System.out.println("세션에 저장된 사용자 이름: " + sessionName);
			%>	
			    <p>로그인된 사용자: <%= sessionName %></p>
			<%
			    } else {
			%>
				System.out.println("세션에 사용자 이름이 저장되지 않음");
			    <p>로그인된 사용자 정보가 없습니다.</p>
			<%
			    }
			%>
			
			
            <!-- 댓글 작성 버튼을 로그인된 사용자에게만 표시 -->
            <%
                if (session.getAttribute("memName") != null) {
            %>
                <button type="button" class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#commentModal">
                    댓글 작성
                </button>
            <%
                } else {
            %>
                <p style="color: red;">로그인 후 댓글을 작성할 수 있습니다.</p>
            <%
                }
            %>
        </div>

        <!-- 오른쪽 섹션 -->
        <div class="right-section">
            <label for="name">작성자:</label>
            <div id="name"><%= board.getName() %></div><br>

            <label for="email">작성자 email : </label>
            <div id="email"><%= board.getEmail() %></div><br>

            <label for="logtime">작성일:</label>
            <div id="logtime"><%= board.getLogtime() %></div><br>

            <label for="hit">조회수:</label>
            <div id="hit"><%= board.getHit() %></div><br>

            <input type="button" value="목록으로" onclick="location.href='boardList.jsp'">
        </div>
    </div>  

    <!-- 댓글 작성 모달 -->
    <div class="modal fade" id="commentModal" tabindex="-1" aria-labelledby="commentModalLabel" aria-hidden="true">
      <div class="modal-dialog">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title" id="commentModalLabel">댓글 작성</h5>
            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
          </div>
          <div class="modal-body">
            <form id="commentForm" action="addComment.jsp" method="post">
              <div class="mb-3">
                <label for="commentContent" class="form-label">댓글 내용</label>
                <textarea class="form-control" id="commentContent" name="commentContent" rows="3"></textarea>
              </div>
              <input type="hidden" name="boardSeq" value="<%= seq %>">
            </form>
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">닫기</button>
            <button type="submit" form="commentForm" class="btn btn-primary">댓글 저장</button>
          </div>
        </div>
      </div>
    </div>

    <script type="text/javascript" src="http://code.jquery.com/jquery-3.7.1.min.js"></script>
</body>
</html>
