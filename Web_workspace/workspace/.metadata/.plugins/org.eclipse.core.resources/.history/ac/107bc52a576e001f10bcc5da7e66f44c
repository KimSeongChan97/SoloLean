<%@ page language="java" contentType="text/html; charset=UTF-8" pageEncoding="UTF-8"%>
<%@ page import="board.dao.BoardDAO" %>
<%@ page import="board.bean.BoardDTO" %>
<%@ page import="java.util.List" %>

<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>게시글 목록</title>
    <link rel="stylesheet" type="text/css" href="/projectJSP/css/boardList.css">
</head>
<body>

    <jsp:include page="/jsp/nav.jsp" />

    <h2 align="center" style="font-family: 'Comic Sans MS';" onclick="location.href='../index.jsp'">N o t e </h2>

    <%
        // 페이징 관련 변수 설정
        int currentPage = (request.getParameter("page") != null) ? Integer.parseInt(request.getParameter("page")) : 1; // 현재 페이지
        int postsPerPage = 5; // 한 페이지당 보여줄 게시글 수
        int totalPosts = BoardDAO.getInstance().getTotalPosts(); // 총 게시글 수
        int totalPages = (int)Math.ceil((double)totalPosts / postsPerPage); // 총 페이지 수

        int startPage = Math.max(1, currentPage - 2); // 페이지네이션에서 시작 페이지 번호
        int endPage = Math.min(totalPages, currentPage + 2); // 페이지네이션에서 끝 페이지 번호

        // DAO를 통해 현재 페이지에 해당하는 게시글 목록 가져오기
        BoardDAO boardDAO = BoardDAO.getInstance();
        List<BoardDTO> boardList = boardDAO.getBoardListByPage(currentPage, postsPerPage);
    %>

    <table border="1" style="width: 100%;">
        <tr>
            <th>번호</th>
            <th>제목</th>
            <th>작성자</th>
            <th>작성일</th>
            <th>조회수</th>
        </tr>

        <%
            for (BoardDTO board : boardList) {
        %>
        <tr>
            <td><%= board.getSeq() %></td>
            <td><a href="boardView.jsp?seq=<%= board.getSeq() %>"><%= board.getSubject() %></a></td>
            <td><%= board.getName() %></td>
            <td><%= board.getLogtime() %></td>
            <td><%= board.getHit() %></td>
        </tr>
        <%
            }
        %>
    </table>

    <!-- 페이징 처리 -->
    <nav aria-label="Page navigation" class="pagination-nav" style="margin-top: 20px;">
      <ul class="pagination justify-content-center">
        <!-- 이전 페이지 -->
        <li class="page-item <%= (currentPage == 1) ? "disabled" : "" %>">
          <a class="page-link" href="?page=<%= (currentPage > 1) ? currentPage - 1 : 1 %>" aria-label="Previous">
            <span aria-hidden="true">&laquo;</span>
          </a>
        </li>

        <!-- 페이지 번호 -->
        <%
            for (int i = startPage; i <= endPage; i++) {
        %>
        <li class="page-item <%= (i == currentPage) ? "active" : "" %>">
          <a class="page-link" href="?page=<%= i %>"><%= i %></a>
        </li>
        <%
            }
        %>

        <!-- 다음 페이지 -->
        <li class="page-item <%= (currentPage == totalPages) ? "disabled" : "" %>">
          <a class="page-link" href="?page=<%= (currentPage < totalPages) ? currentPage + 1 : totalPages %>" aria-label="Next">
            <span aria-hidden="true">&raquo;</span>
          </a>
        </li>
      </ul>
    </nav>

    <script type="text/javascript" src="http://code.jquery.com/jquery-3.7.1.min.js"></script>
</body>
</html>
