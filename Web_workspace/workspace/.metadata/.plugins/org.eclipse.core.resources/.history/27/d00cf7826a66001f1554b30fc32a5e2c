<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>메인 페이지</title>
    <!-- CSS 파일 연결 -->
    <link rel="stylesheet" href="css/style.css">
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body onload="initPage()"> <!-- 페이지가 로드될 때 initPage() 함수를 호출하여 초기화 작업 수행 -->
    <!-- 네비게이션 바 시작 -->
    <div id="navbar-placeholder"></div> <!-- 네비게이션 바가 동적으로 로드될 영역 -->

    <script>
        // 외부 파일에서 네비게이션 바 내용을 가져와서 페이지에 삽입
        fetch('navbar.html')
            .then(response => response.text())
            .then(data => {
                document.getElementById('navbar-placeholder').innerHTML = data;
            });
    </script>
    <!-- 네비게이션 바 끝 -->

    <main style="display: block; padding: 20px;">
        <!-- 메인 콘텐츠 영역 -->
        <div id="weather-container">
            <!-- 날씨 정보가 표시될 영역 -->
            <div id="weather-data"></div> <!-- 날씨 데이터가 표시될 DIV -->
        </div>
        <div id="map" style="width:500px;height:400px;margin-top:20px;">
            <!-- 지도가 표시될 영역 -->
        </div>

        <!-- 위치 검색 기능을 제공하는 폼 -->
        <div class="container mt-3">
            <label for="text-input">위치를 찾아볼까요</label>
            <br>
		    <label for="location-input">위치 검색</label>
		    <input id="location-input" class="form-control" type="text" placeholder="검색할 위치를 입력하세요...">
		    <button id="search-button" class="btn btn-primary mt-2">검색</button>
        </div>
        
        <!-- 위치 정보 및 길찾기 버튼을 표시하는 팝업 -->
		<div id="info-popup" class="info-popup">
		    <div id="info-content"></div> <!-- 위치 정보가 표시될 DIV -->
		    <button id="directions-button" class="btn btn-primary mt-2">길찾기</button> <!-- 길찾기 버튼 -->
		</div>
		<div id="directions-panel" class="directions-panel"></div> <!-- 길찾기 경로가 표시될 패널 -->
    </main>

    <!-- 뒤로 가기 버튼 -->
    <div id="back-button" onclick="goBack()">
        <img src="images/back.png" alt="뒤로가기"> <!-- 뒤로가기 이미지를 포함 -->
    </div>

    <!-- 사용자 정의 스크립트 파일 -->
    <script src="js/script.js"></script>
    <!-- 구글 맵 API 스크립트 -->
    <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyA6HiNNMKqiPrXZsNR4ekZycjE5Kzg4wOw&callback=initMap" async defer></script>
    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    <!-- JQuery 라이브러리 -->
    <script type="text/javascript" src="http://code.jquery.com/jquery-3.7.1.min.js"></script>

    <!-- JQuery를 이용한 길찾기 기능 -->
    <script type="text/javascript">
    $(function(){
        // 길찾기 버튼 클릭 시 이벤트 리스너 등록
	    document.getElementById('directions-button').addEventListener('click', function() {
	        calculateAndDisplayRoute(); // 길찾기 함수 호출
	    });

	    // 길찾기 경로를 계산하고 화면에 표시하는 함수
	    function calculateAndDisplayRoute() {
	        if (navigator.geolocation) {
	            // 사용자의 현재 위치를 가져옴
	            navigator.geolocation.getCurrentPosition(function(position) {
	                const origin = {
	                    lat: position.coords.latitude, // 현재 위치의 위도
	                    lng: position.coords.longitude  // 현재 위치의 경도
	                };
	                const destination = currentMarker.getPosition(); // 선택된 마커의 위치를 목적지로 설정
	                const directionsService = new google.maps.DirectionsService(); // 길찾기 서비스 객체 생성
	                const directionsRenderer = new google.maps.DirectionsRenderer(); // 길찾기 결과 렌더링 객체 생성

	                directionsRenderer.setMap(map); // 길찾기 결과를 표시할 지도 설정
	                directionsRenderer.setPanel(document.getElementById('directions-panel')); // 결과를 표시할 패널 설정

	                // 길찾기 경로 요청
	                directionsService.route(
	                    {
	                        origin: origin, // 출발지
	                        destination: destination, // 목적지
	                        travelMode: google.maps.TravelMode.DRIVING // 이동 수단 (운전)
	                    },
	                    function(response, status) {
	                        if (status === google.maps.DirectionsStatus.OK) {
	                            // 길찾기 결과가 성공적이면 결과를 렌더링
	                            directionsRenderer.setDirections(response);
	                            document.getElementById('directions-panel').classList.add('visible'); // 경로 패널 표시
	                        } else {
	                            // 경로 요청 실패 시 알림
	                            alert('길찾기 요청에 실패했습니다: ' + status);
	                        }
	                    }
	                );
	            });
	        } else {
	            // 현재 위치를 사용할 수 없을 때 알림
	            alert('현재 위치를 사용할 수 없습니다.');
	        }
	    }

    });
    </script>
</body>
</html>
