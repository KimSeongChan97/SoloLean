<%@ page language="java" contentType="text/html; charset=UTF-8" pageEncoding="UTF-8"%>
<%@ taglib prefix="c" uri="http://java.sun.com/jsp/jstl/core" %>
<%@ taglib prefix="fn" uri="http://java.sun.com/jsp/jstl/functions" %> <!-- JSTL 함수 라이브러리 추가 -->
<%@ page import="board.dao.BoardDAO" %>
<%@ page import="board.bean.BoardDTO" %>
<%@ page import="java.util.List" %>

<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>게시글 목록</title>
    <link rel="stylesheet" type="text/css" href="/projectJSP/css/boardList.css">
</head>
<body>

    <jsp:include page="/jsp/nav.jsp" />

    <h2 align="center" style="font-family: 'Comic Sans MS';" onclick="location.href='../index.jsp'">N o t e </h2>

    <%
        // 페이징 관련 변수 설정
        int currentPage = (request.getParameter("page") != null) ? Integer.parseInt(request.getParameter("page")) : 1;
        int postsPerPage = 5;
        int totalPosts = BoardDAO.getInstance().getTotalPosts();
        int totalPages = (int)Math.ceil((double)totalPosts / postsPerPage);
        int startPage = Math.max(1, currentPage - 2);
        int endPage = Math.min(totalPages, currentPage + 2);
        
        // 게시글 목록 불러오기
        BoardDAO boardDAO = BoardDAO.getInstance();
        List<BoardDTO> boardList = boardDAO.getBoardListByPage(currentPage, postsPerPage);

        // 데이터를 JSP에서 사용할 수 있도록 request에 설정
        request.setAttribute("boardList", boardList);
        request.setAttribute("currentPage", currentPage);
        request.setAttribute("totalPages", totalPages);
        request.setAttribute("startPage", startPage);
        request.setAttribute("endPage", endPage);
    %>

    <table border="1" style="width: 100%;">
        <tr>
            <th>번호</th>
            <th>제목</th>
            <th>작성자</th>
            <th>작성일</th>
            <th>조회수</th>
        </tr>

        <!-- 게시글 목록 출력 -->
        <c:forEach var="board" items="${boardList}">
            <tr>
                <td>${board.seq}</td>
                <td><a href="boardView.jsp?seq=${board.seq}">${board.subject}</a></td>
                <td>${board.name}</td>
                <td>${board.logtime}</td>
                <td>${board.hit}</td>
            </tr>
        </c:forEach>
    </table>

    <!-- 페이징 처리 -->
    <nav aria-label="Page navigation" class="pagination-nav" style="margin-top: 20px;">
      <ul class="pagination justify-content-center">
        <!-- 이전 페이지로 이동 -->
        <li class="page-item ${currentPage == 1 ? 'disabled' : ''}">
          <a class="page-link" href="?page=${currentPage > 1 ? currentPage - 1 : 1}" aria-label="Previous">
            <span aria-hidden="true">&laquo;</span>
          </a>
        </li>

        <!-- 페이지 번호 출력 -->
        <c:forEach begin="${startPage}" end="${endPage}" var="i">
            <li class="page-item ${i == currentPage ? 'active' : ''}">
              <a class="page-link" href="?page=${i}">${i}</a>
            </li>
        </c:forEach>

        <!-- 다음 페이지로 이동 -->
        <li class="page-item ${currentPage == totalPages ? 'disabled' : ''}">
          <a class="page-link" href="?page=${currentPage < totalPages ? currentPage + 1 : totalPages}" aria-label="Next">
            <span aria-hidden="true">&raquo;</span>
          </a>
        </li>
      </ul>
    </nav>

    <script type="text/javascript" src="http://code.jquery.com/jquery-3.7.1.min.js"></script>
</body>
</html>
