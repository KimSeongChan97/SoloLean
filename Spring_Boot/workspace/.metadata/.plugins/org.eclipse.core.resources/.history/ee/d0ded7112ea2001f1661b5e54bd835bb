$(function(){
	// 회원가입
    // 초기화: 입력 시 오류 메시지 제거
    $('#id').on('input', function() {
        $('#idDiv').empty(); // 아이디 입력란에 입력 시, 오류 메시지를 제거하여 사용자가 오타를 수정하면 바로 피드백이 사라지도록 함
    });
    $('#pwd').on('input', function() {
        $('#pwdDiv').empty(); // 비밀번호 입력란에 입력 시, 오류 메시지를 제거함
    });
    $('#name').on('input', function() {
        $('#nameDiv').empty(); // 이름 입력란에 입력 시, 오류 메시지를 제거하여 사용자가 입력 중 오류 메시지가 즉시 사라지게 함
    });

    $('#writeBtn').click(function(){
        // 모든 메시지 초기화
        $('#idDiv').empty(); // 아이디 오류 메시지를 초기화하여 기존의 메시지가 남아 있지 않도록 함
        $('#pwdDiv').empty(); // 비밀번호 오류 메시지를 초기화하여 입력 확인 상태를 새로 시작함
        $('#nameDiv').empty(); // 이름 오류 메시지를 초기화하여 입력 상태를 새롭게 시작하도록 함
        
        // 입력값 확인 및 오류 메시지 표시
        if($('#id').val() == ''){ // 아이디가 입력되지 않은 경우
            $('#idDiv').text('아이디 입력'); // 사용자에게 '아이디 입력'이라는 오류 메시지를 보여줌
            $('#id').focus(); // 아이디 입력란으로 커서를 이동하여 사용자에게 입력을 유도함
        } else if ($('#pwd').val() == ''){ // 비밀번호가 입력되지 않은 경우
            $('#pwdDiv').text('비밀번호 입력'); // 사용자에게 '비밀번호 입력' 메시지를 보여줌
            $('#pwd').focus(); // 비밀번호 입력란으로 커서를 이동하여 입력을 유도함
        } else if ($('#name').val() == ''){ // 이름이 입력되지 않은 경우
            $('#nameDiv').text('이름 입력'); // 사용자에게 '이름 입력' 메시지를 보여줌
            $('#name').focus(); // 이름 입력란으로 커서를 이동하여 입력을 유도함
        } else { // 모든 필수 입력란이 입력된 경우
            $.ajax({
				type: 'post', // 서버에 데이터를 전송하는 방식으로 POST를 사용 (보안 및 대용량 데이터 전송에 유리)
				url: '/member/write', // 서버의 회원가입 처리 URL로 요청을 보냄
				data: $('#writeForm').serialize(), // 폼 데이터를 문자열로 변환하여 서버에 전송 (key=value 형식)
				success: function(){ // 서버로부터 응답이 성공적으로 돌아온 경우
					alert('회원가입 완료'); // 성공 알림을 사용자에게 표시
					//location.href='/member/list'; // 회원 목록 페이지로 이동하여 가입한 내용을 확인할 수 있도록 함
				},
				error: function(e){ // 서버와의 통신 중 에러가 발생한 경우
					console.log(e); // 오류 내용을 콘솔에 기록하여 개발자가 확인할 수 있도록 함
				}
            }); // $.ajax
        }
        
    }); // 회원가입 버튼 클릭


    // 아이디 중복 체크
    $('#id').focusout(function(){
        $('#idDiv').empty(); // 아이디 입력란에 기존 메시지를 초기화하여 새로운 메시지를 표시할 준비를 함

        if($('#id').val() == '') // 아이디 입력란이 비어 있는지 확인
            $('#idDiv').text('먼저 아이디 입력'); // 아이디 입력 없이 포커스를 벗어나면 '먼저 아이디 입력' 메시지를 표시
        else
            $.ajax({
                type: 'post', // 서버에 데이터를 POST 방식으로 전송하여 요청
                url: '/member/isExistId', // 서버의 아이디 중복 체크 URL로 요청을 보냄
                data: 'id=' + $('#id').val(), // 사용자가 입력한 아이디를 서버로 전송, 변수명 'id'와 값을 쌍으로 전송
                dataType: 'text', // 서버로부터 받는 데이터의 형식을 텍스트로 지정 (문자열 형태로 받음)
                success: function(data){ // 서버로부터 응답을 성공적으로 받았을 때
                    // alert(data); // 디버깅 목적으로 응답 데이터를 확인할 수 있음 (현재는 주석 처리됨)
                    if(data == 'exist') // 서버 응답이 'exist'일 경우 (이미 존재하는 아이디)
                        $('#idDiv').html('사용 불가능').css('color', 'red'); // '사용 불가능' 메시지를 빨간색으로 표시하여 중복 아이디임을 알림
                    else if(data == 'non_exist') // 서버 응답이 'non_exist'일 경우 (중복되지 않는 아이디)
                        $('#idDiv').html('사용 가능').css('color', 'blue'); // '사용 가능' 메시지를 파란색으로 표시하여 사용 가능한 아이디임을 알림
                },
                error: function(e){ // 서버와의 통신 중 오류가 발생한 경우
                    console.log(e); // 오류 내용을 콘솔에 기록하여 개발자가 확인할 수 있도록 함
                }
            }); // $.ajax
    }); // 아이디 중복 체크
});
